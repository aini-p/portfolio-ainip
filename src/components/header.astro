---
import { ui } from "~/i18n/ui";
const { pathname } = Astro.url;
const { lang } = Astro.locals;
const t = ui[lang];

// ▼▼▼ ナビゲーションとスイッチャーのパス生成ロジックを修正 ▼▼▼
const galleryPath = lang === 'ja' ? '/' : '/en';
const profilePath = lang === 'ja' ? '/profile' : '/en/profile';

let jaPath, enPath;
if (lang === 'en') {
  // 現在英語ページ (/en/foo)
  jaPath = pathname.replace(/^\/en/, '') || '/'; // /en を削除、空なら /
  enPath = pathname;
} else {
  // 現在日本語ページ (/foo)
  jaPath = pathname;
  enPath = `/en${pathname === '/' ? '' : pathname}`; // /en を先頭に追加 (ルートの場合は /en)
}
// ルートパスの場合、末尾のスラッシュを保証
if (jaPath === '') jaPath = '/';
if (enPath === '/en') enPath = '/en/';
// ▲▲▲ ここまで ▲▲▲
---
<header>
  <nav>
    {/* ▼▼▼ hrefとactiveの判定を修正 ▼▼▼ */}
    <a href={galleryPath} class:list={{ active: pathname === '/' || pathname === '/en' || pathname === '/en/' }}>{t['nav.gallery']}</a>
    <a href={profilePath} class:list={{ active: pathname.startsWith('/profile') || pathname.startsWith('/en/profile') }}>{t['nav.profile']}</a>
    {/* ▲▲▲ ここまで ▲▲▲ */}
  </nav>
  <div class="language-switcher">
    {lang === 'ja' ? <span>JA</span> : <a href={jaPath}>JA</a>}
    <span>|</span>
    {lang === 'en' ? <span>EN</span> : <a href={enPath}>EN</a>}
  </div>
</header>
<style>
  /* ... (styleタグの中身は変更なし) ... */
  header { position: fixed; top: 0; left: 0; width: 100%; display: flex; justify-content: center; align-items: center; padding: 1rem; background-color: rgba(255, 255, 255, 0.7); backdrop-filter: blur(10px); z-index: 10; }
  nav { display: flex; gap: 2rem; }
  nav a {
    color: #333; text-decoration: none; font-weight: 600; /* ヘッダーのウェイトは600のままにする */
    padding: 0.5rem 0; border-bottom: 2px solid transparent;
    transition: border-color 0.3s;
    font-size: 0.9rem; /* サイズを0.9remに戻す */
  }
  nav a:hover, nav a.active { border-color: #333; }
  .language-switcher { display: flex; align-items: center; gap: 0.5rem; position: absolute; right: 1.5rem; font-weight: 600; }
  .language-switcher a { color: #888; text-decoration: none; }
  .language-switcher span { color: #333; }
  /* ▼▼▼ モバイル対応を追加 ▼▼▼ */
  @media (max-width: 768px) {
    header {
      justify-content: space-between; /* 要素を左右に寄せる */
      padding: 0.5rem 1rem; /* 上下のパディングを減らす */
    }
    nav {
      gap: 1rem; /* ナビゲーション間のスペースを減らす */
    }
    nav a {
      font-size: 0.8rem; /* 文字を少し小さくする */
      padding: 0.3rem 0;
    }
    .language-switcher {
      position: static; /* 右端固定をやめる */
      font-size: 0.8rem;
    }
  }
  @media (prefers-color-scheme: dark) {
    header { background-color: rgba(0, 0, 0, 0.7); }
    nav a { color: #eee; }
    nav a:hover, nav a.active { border-color: #eee; }
    .language-switcher a { color: #777; }
    .language-switcher span { color: #eee; }
  }
</style>